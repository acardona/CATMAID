{% load data_view_config %}
{% include "catmaid/common_data_view_header.html" %}

{% with catalogue_link=config|get_or_none:"catalogue_link"|default_if_none:1 %}
{% with sample_images=config|get_or_none:"sample_images"|default_if_none:0 %}
{% with sample_stack=config|get_or_none:"sample_stack"|default_if_none:0 %}
{% with sample_slice=config|get_or_none:"sample_slice"|default_if_none:"center" %}
{% with sample_scaling=config|get_or_none:"sample_scaling"|default_if_none:100 %}
<table>
{% for p in projects %}
    {% if p.stacks.all|length > 0 %}
    <tr>
        {# Add a sample image if requested #}
        {% if sample_images %}
            <td class="stackimage">
            {# Get the samlpe stack  #}
            {% with stack=p.stacks|get_stack:sample_stack %}
            {% if stack|is_none %}
                Couldn't find requested stack: {{ sample_stack }}
            {% else %}
                {# Get the wanted slice #}
                {% with slice=stack|get_slice:sample_slice %}
                {% if slice|is_none %}
                    Couldn't find requested slice: {{ sample_slice }}
                {% else %}
                    <img src="{{ stack.image_base }}{{ slice }}/small.{{ stack.file_extension }}"
                        alt="Sample image for {{ stack.title }} on slice {{ slice }}"
                        width="{{ sample_scaling }}%" />
                {% endif %}
                {% endwith %}
            {% endif %}
            {% endwith %}
            </td>
        {% endif %}
        <td class="stackname">
            <dl>
                <dt>{{ p.title }}</dt>
                {% for s in p.stacks.all %}
                <dd><a href="#" onclick="openProjectStack({{p.id}}, {{s.id}})">{{ s.title }}</a></dd>
                {% endfor %}
                {# Optionally, add the the neuron catalogue link #}
                {% if p.is_catalogueable and catalogue_link %}
                    <dd><a href="{{ settings.CATMAID_DJANGO_URL }}{{ p.id }}">Browse the Neuron Catalogue</a></dd>
                {% endif %}
            </dl>
        </td>
    </tr>
    {% endif %}
{% endfor %}
</table>
{% endwith %}
{% endwith %}
{% endwith %}
{% endwith %}
{% endwith %}
